<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Deutschland Umfragen – Dark Mode</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
body { 
  margin:0;
  font-family:Inter,sans-serif;
  background:#121212;
  color:#e0e0e0;
  position:relative;
  overflow-x:hidden;
}
body::before {
  content:"";
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background-image:url('reichstag.png');
  background-size:cover;
  background-position:center;
  filter:blur(8px) brightness(0.3);
  z-index:-1;
}
h1 { text-align:center;padding:1rem;margin-bottom:0.5rem }
.newest-poll-date { text-align:center;color:#999;font-size:14px;margin-bottom:1.5rem }
.new-badge { display:inline-block;background:#4f7a5a;color:#fff;padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;margin-top:10px }
.bundestag-section { max-width:1400px;margin:0 auto 2rem;padding:0 2rem }
.bundestag-container { background:#1e1e1e;border-radius:16px;padding:1.5rem;position:relative;overflow:hidden;border:2px solid transparent }
.bundestag-container::before { content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:400px;height:400px;background-image:url('https://upload.wikimedia.org/wikipedia/commons/thumb/d/da/Coat_of_arms_of_Germany.svg/960px-Coat_of_arms_of_Germany.svg.png');background-size:contain;background-repeat:no-repeat;background-position:center;opacity:0.08;pointer-events:none;z-index:0 }
.bundestag-container h2 { margin:0 0 0.5rem 0;font-size:18px;position:relative;z-index:1 }
.bundestag-container .date { color:#999;font-size:14px;margin-bottom:1rem;position:relative;z-index:1 }
.bundestag-container .badge-container { position:relative;z-index:1;margin-top:1rem;text-align:center }
.main { display:flex;max-width:1400px;margin:auto;gap:2rem }
.states { display:grid;grid-template-columns:repeat(4,1fr);gap:1.5rem;padding:2rem;width:50% }
.state { background:#1e1e1e;border-radius:16px;padding:1rem;text-align:center;cursor:pointer;transition:all 0.3s ease;border:2px solid transparent;position:relative;display:flex;flex-direction:column;min-height:140px }
.state:hover { background:#2a2a2a;transform:translateY(-2px) }
.state.active { background:#2d2d2d;border:2px solid #4f7fa8 }
.state-content { flex:1;display:flex;flex-direction:column;justify-content:center }
.state img { width:70px;height:70px;object-fit:contain;margin:auto;display:block }
.state-name { margin-top:0.5rem;font-size:14px;font-weight:600 }
.state .badge-container { margin-top:auto;padding-top:0.5rem }
.panel { width:50%;padding:2rem;background:#181818;position:relative;overflow:hidden }
.panel::before { content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:400px;height:400px;background-image:var(--bg-coat);background-size:contain;background-repeat:no-repeat;background-position:center;opacity:0.08;pointer-events:none;transition:all 0.5s ease }
.panel h2 { margin-bottom:0.5rem }
.panel .date { color:#999;font-size:14px;margin-bottom:1.5rem }
.bar-row { display:flex;align-items:center;gap:10px;margin:.8rem 0;position:relative;z-index:1 }
.party-logo { width:26px;height:26px;object-fit:contain }
.bar { height:26px;border-radius:6px;display:flex;align-items:center;padding-left:8px;font-size:13px;font-weight:600;transition:all 0.3s ease;width:0;animation:none }
.bar.animate { animation:expandBar 0.8s ease-out forwards }
@keyframes expandBar {
  from { width:0; opacity:0 }
  to { opacity:1 }
}
.bar:hover { opacity:0.8 }
.percent { width:100px;text-align:right;font-weight:600 }
.history-section { margin-top:3rem;padding-top:2rem;border-top:1px solid #333 }
.history-section h3 { font-size:16px;margin-bottom:1rem;color:#999 }
.history-row { margin:1.5rem 0;padding:1rem;background:#1e1e1e;border-radius:8px }
.history-date { font-size:13px;color:#999;margin-bottom:0.8rem }
.history-parties { display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:0.8rem }
.history-party { text-align:center }
.history-party-name { font-size:11px;color:#aaa;margin-bottom:0.2rem }
.history-party-value { font-size:14px;font-weight:600 }
.trend { display:inline-block;margin-left:6px;font-size:11px;font-weight:600 }
.trend.up { color:#4f7a5a }
.trend.down { color:#a33a3a }
.trend.same { color:#666 }
</style>
</head>
<body>
<h1>Deutschland Umfragen</h1>
<div class="newest-poll-date" id="newest-poll-info"></div>
<div class="bundestag-section">
<div class="bundestag-container">
<h2>Aktuelle Bundestag Umfrage</h2>
<div class="date" id="bundestag-date"></div>
<div id="bundestag-bars"></div>
<div class="badge-container" id="bundestag-badge"></div>
</div>
</div>
<div class="main">
<div class="states" id="states"></div>
<div class="panel">
<h2 id="title">Bundesland auswählen</h2>
<div class="date" id="date"></div>
<div id="bars"></div>
<div class="history-section">
<h3>Frühere Umfragen</h3>
<div id="history"></div>
</div>
</div>
</div>

<script>
const colors = {
"CSU":"#008AC5","CDU":"#000000","AfD":"#009EE0","BSW":"#8B1874",
"SPD":"#E3000F","Grüne":"#64A12D","FDP":"#FFED00","Linke":"#BE3075","FW":"#EE7D00","Sonstige":"#666"
};

const logos = {
"CSU":"https://upload.wikimedia.org/wikipedia/commons/thumb/e/ee/CSU_Logo_since_2016.svg/960px-CSU_Logo_since_2016.svg.png",
"CDU":"https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/CDU_Logo_2023.svg/960px-CDU_Logo_2023.svg.png",
"AfD":"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b1/AfD_Logo_2021.svg/250px-AfD_Logo_2021.svg.png",
"BSW":"https://upload.wikimedia.org/wikipedia/de/thumb/a/ad/B%C3%BCndnis_Sahra_Wagenknecht_2025_logo.svg/250px-B%C3%BCndnis_Sahra_Wagenknecht_2025_logo.svg.png",
"SPD":"https://upload.wikimedia.org/wikipedia/commons/4/4f/Logo_SPD_2019.png",
"Grüne":"https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/B%C3%BCndnis_90_-_Die_Gr%C3%BCnen_Logo_%28transparent%29.svg/250px-B%C3%BCndnis_90_-_Die_Gr%C3%BCnen_Logo_%28transparent%29.svg.png",
"FDP":"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e2/Logo_der_Freien_Demokraten.svg/250px-Logo_der_Freien_Demokraten.svg.png",
"Linke":"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d6/Logo_Die_Linke_%282023%29.svg/330px-Logo_Die_Linke_%282023%29.svg.png",
"FW":"https://upload.wikimedia.org/wikipedia/de/thumb/7/7e/FreieW%C3%A4hlerBundesvereinigungLogo.svg/330px-FreieW%C3%A4hlerBundesvereinigungLogo.svg.png",
"Sonstige":"https://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Question_mark_%28black%29.svg/250px-Question_mark_%28black%29.svg.png"
};

const stateCoats = {
"Baden-Württemberg":"https://upload.wikimedia.org/wikipedia/commons/thumb/0/0f/Lesser_coat_of_arms_of_Baden-W%C3%BCrttemberg.svg/960px-Lesser_coat_of_arms_of_Baden-W%C3%BCrttemberg.svg.png",
"Bayern":"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d2/Bayern_Wappen.svg/960px-Bayern_Wappen.svg.png",
"Berlin":"https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/DEU_Berlin_COA.svg/960px-DEU_Berlin_COA.svg.png",
"Brandenburg":"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/DEU_Brandenburg_COA.svg/960px-DEU_Brandenburg_COA.svg.png",
"Bremen":"https://upload.wikimedia.org/wikipedia/commons/6/64/Bremen_Wappen%28Mittel%29.svg",
"Hamburg":"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/DEU_Hamburg_COA.svg/960px-DEU_Hamburg_COA.svg.png",
"Hessen":"https://upload.wikimedia.org/wikipedia/commons/thumb/c/cd/Coat_of_arms_of_Hesse.svg/960px-Coat_of_arms_of_Hesse.svg.png",
"Mecklenburg-Vorpommern":"https://upload.wikimedia.org/wikipedia/commons/thumb/7/74/Coat_of_arms_of_Mecklenburg-Western_Pomerania_%28great%29.svg/960px-Coat_of_arms_of_Mecklenburg-Western_Pomerania_%28great%29.svg.png",
"Niedersachsen":"https://upload.wikimedia.org/wikipedia/commons/thumb/0/01/Wappen_von_Niedersachsen.svg/960px-Wappen_von_Niedersachsen.svg.png",
"Nordrhein-Westfalen":"https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/Coat_of_arms_of_North_Rhine-Westphalia.svg/960px-Coat_of_arms_of_North_Rhine-Westphalia.svg.png",
"Rheinland-Pfalz":"https://upload.wikimedia.org/wikipedia/commons/thumb/8/89/Coat_of_arms_of_Rhineland-Palatinate.svg/960px-Coat_of_arms_of_Rhineland-Palatinate.svg.png",
"Saarland":"https://upload.wikimedia.org/wikipedia/commons/thumb/8/8e/Wappen_des_Saarlands.svg/960px-Wappen_des_Saarlands.svg.png",
"Sachsen":"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Coat_of_arms_of_Saxony.svg/960px-Coat_of_arms_of_Saxony.svg.png",
"Sachsen-Anhalt":"https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Wappen_Sachsen-Anhalt.svg/960px-Wappen_Sachsen-Anhalt.svg.png",
"Schleswig-Holstein":"https://upload.wikimedia.org/wikipedia/commons/thumb/f/f0/Schleswig-Holstein-Wappen-Drucksache-17-1664.svg/960px-Schleswig-Holstein-Wappen-Drucksache-17-1664.svg.png",
"Thüringen":"https://upload.wikimedia.org/wikipedia/commons/thumb/0/08/Coat_of_arms_of_Thuringia.svg/960px-Coat_of_arms_of_Thuringia.svg.png"
};

// Bundestag data with CDU/CSU combined
const bundestagData = {
  'date': '09.02.2026',
  'results': {'CDU/CSU': 25.9, 'AfD': 24.6, 'SPD': 15, 'Grüne': 11.9, 'BSW': 3.3, 'FDP': 3, 'Linke': 10.2, 'Sonstige': 6.1},
  'history': [
    {'date': '02.02.2026', 'results': {'CDU/CSU': 25.9, 'AfD': 24.6, 'SPD': 15, 'Grüne': 11.9, 'BSW': 3.3, 'FDP': 3, 'Linke': 10.2, 'Sonstige': 6.1}}
  ]
};

// Add CDU/CSU to colors and logos
colors['CDU/CSU'] = '#000000';
logos['CDU/CSU'] = 'https://upload.wikimedia.org/wikipedia/de/thumb/7/7a/CDU-CSU-10.svg/330px-CDU-CSU-10.svg.png?20110122100932';

const data = {
'Baden-Württemberg': {
  'date': '29.01.2026', 
  'results': {'CDU': 29, 'SPD': 10, 'AfD': 20, 'FDP': 5, 'BSW': 3, 'Grüne': 21, 'Linke': 7, 'Sonstige': 5},
  'history': [
    {'date': '22.01.2026', 'results': {'CDU': 29, 'SPD': 8, 'AfD': 20, 'FDP': 5, 'BSW': 0, 'Grüne': 23, 'Linke': 7, 'Sonstige': 8}},
    {'date': '16.10.2025', 'results': {'CDU': 31, 'SPD': 11, 'AfD': 20, 'FDP': 7, 'BSW': 3, 'Grüne': 17, 'Linke': 7, 'Sonstige': 4}},
    {'date': '16.10.2025', 'results': {'CDU': 29, 'SPD': 10, 'AfD': 21, 'FDP': 5, 'BSW': 3, 'Grüne': 20, 'Linke': 7, 'Sonstige': 5}}
  ]
}, 
'Bayern': {
  'date': '19.01.2026', 
  'results': {'CSU': 40, 'SPD': 7, 'AfD': 18, 'FDP': 2, 'BSW': 1, 'Grüne': 12, 'FW': 11, 'Linke': 3, 'Sonstige': 6},
  'history': [
    {'date': '14.01.2026', 'results': {'CSU': 39, 'SPD': 8, 'AfD': 19, 'FDP': 0, 'BSW': 0, 'Grüne': 13, 'FW': 9, 'Linke': 3, 'Sonstige': 9}},
    {'date': '05.01.2026', 'results': {'CSU': 39, 'SPD': 6, 'AfD': 19, 'FDP': 2, 'BSW': 2, 'Grüne': 11, 'FW': 12, 'Linke': 3, 'Sonstige': 6}},
    {'date': '17.12.2025', 'results': {'CSU': 37, 'SPD': 8, 'AfD': 21, 'FDP': 2, 'BSW': 2, 'Grüne': 12, 'FW': 10, 'Linke': 4, 'Sonstige': 4}}
  ]
}, 
'Berlin': {
  'date': '26.01.2026', 
  'results': {'CDU': 22, 'SPD': 15, 'AfD': 16, 'FDP': 3, 'BSW': 3, 'Grüne': 17, 'Linke': 17, 'Sonstige': 7},
  'history': [
    {'date': '16.01.2026', 'results': {'CDU': 22, 'SPD': 14, 'AfD': 17, 'FDP': 0, 'BSW': 3, 'Grüne': 16, 'Linke': 18, 'Sonstige': 10}},
    {'date': '14.01.2026', 'results': {'CDU': 22, 'SPD': 17, 'AfD': 16, 'FDP': 3, 'BSW': 4, 'Grüne': 14, 'Linke': 17, 'Sonstige': 7}},
    {'date': '02.12.2025', 'results': {'CDU': 23, 'SPD': 13, 'AfD': 16, 'FDP': 3, 'BSW': 5, 'Grüne': 15, 'Linke': 18, 'Sonstige': 7}}
  ]
}, 
'Brandenburg': {
  'date': '15.01.2026', 
  'results': {'CDU': 13, 'SPD': 25, 'AfD': 34, 'FDP': 0, 'BSW': 8, 'Grüne': 5, 'Linke': 8, 'Sonstige': 7},
  'history': [
    {'date': '10.12.2025', 'results': {'CDU': 14, 'SPD': 22, 'AfD': 35, 'FDP': 0, 'BSW': 7, 'Grüne': 5, 'Linke': 9, 'Sonstige': 8}},
    {'date': '18.09.2025', 'results': {'CDU': 13, 'SPD': 24, 'AfD': 34, 'FDP': 2, 'BSW': 9, 'Grüne': 4, 'Linke': 9, 'Sonstige': 3}},
    {'date': '25.06.2025', 'results': {'CDU': 14, 'SPD': 23, 'AfD': 32, 'FDP': 0, 'BSW': 9, 'Grüne': 5, 'Linke': 9, 'Sonstige': 8}}
  ]
}, 
'Bremen': {
  'date': '28.04.2025', 
  'results': {'CDU': 22, 'SPD': 25, 'AfD': 15, 'FDP': 0, 'BSW': 0, 'Grüne': 14, 'Linke': 13, 'Sonstige': 11},
  'history': [
    {'date': 'XX.XX.XXXX', 'results': {'CDU': 0, 'SPD': 0, 'AfD': 0, 'FDP': 0, 'BSW': 0, 'Grüne': 0, 'Linke': 0, 'Sonstige': 0}},
    {'date': 'XX.XX.XXXX', 'results': {'CDU': 0, 'SPD': 0, 'AfD': 0, 'FDP': 0, 'BSW': 0, 'Grüne': 0, 'Linke': 0, 'Sonstige': 0}},
    {'date': 'XX.XX.XXXX', 'results': {'CDU': 0, 'SPD': 0, 'AfD': 0, 'FDP': 0, 'BSW': 0, 'Grüne': 0, 'Linke': 0, 'Sonstige': 0}}
  ]
}, 
'Hamburg': {
  'date': '01.03.2025', 
  'results': {'CDU': 18, 'SPD': 33.5, 'AfD': 9, 'FDP': 2.5, 'BSW': 2.5, 'Grüne': 16.5, 'Linke': 14, 'Sonstige': 4},
  'history': [
    {'date': '27.02.2025', 'results': {'CDU': 18, 'SPD': 33, 'AfD': 9, 'FDP': 0, 'BSW': 0, 'Grüne': 17, 'Linke': 12, 'Sonstige': 11}},
    {'date': '27.02.2025', 'results': {'CDU': 17, 'SPD': 32, 'AfD': 11, 'FDP': 3, 'BSW': 3, 'Grüne': 16, 'Linke': 13, 'Sonstige': 5}},
    {'date': '20.02.2025', 'results': {'CDU': 17, 'SPD': 32, 'AfD': 10, 'FDP': 3, 'BSW': 3, 'Grüne': 18, 'Linke': 10, 'Sonstige': 7}}
  ]
}, 
'Hessen': {
  'date': '02.02.2026', 
  'results': {'CDU': 32, 'SPD': 16, 'AfD': 20, 'FDP': 3, 'BSW': 0, 'Grüne': 14, 'Linke': 6, 'Sonstige': 9},
  'history': [
    {'date': '09.10.2025', 'results': {'CDU': 32, 'SPD': 15, 'AfD': 20, 'FDP': 4, 'BSW': 3, 'Grüne': 12, 'Linke': 7, 'Sonstige': 7}},
    {'date': '23.06.2025', 'results': {'CDU': 36, 'SPD': 13, 'AfD': 18, 'FDP': 4, 'BSW': 3, 'Grüne': 14, 'Linke': 6, 'Sonstige': 6}},
    {'date': '25.03.2025', 'results': {'CDU': 31, 'SPD': 14, 'AfD': 19, 'FDP': 3, 'BSW': 5, 'Grüne': 12, 'Linke': 9, 'Sonstige': 7}}
  ]
}, 
'Mecklenburg-Vorpommern': {
  'date': '27.01.2026', 
  'results': {'CDU': 13, 'SPD': 25, 'AfD': 35, 'FDP': 0, 'BSW': 6, 'Grüne': 4, 'Linke': 12, 'Sonstige': 5},
  'history': [
    {'date': '25.09.2025', 'results': {'CDU': 13, 'SPD': 19, 'AfD': 38, 'FDP': 0, 'BSW': 7, 'Grüne': 5, 'Linke': 12, 'Sonstige': 6}},
    {'date': '28.04.2025', 'results': {'CDU': 17, 'SPD': 21, 'AfD': 29, 'FDP': 0, 'BSW': 6, 'Grüne': 5, 'Linke': 15, 'Sonstige': 7}},
    {'date': '07.02.2025', 'results': {'CDU': 16, 'SPD': 21, 'AfD': 29, 'FDP': 3, 'BSW': 9, 'Grüne': 7, 'Linke': 8, 'Sonstige': 7}}
  ]
}, 
'Niedersachsen': {
  'date': '19.11.2025', 
  'results': {'CDU': 26, 'SPD': 26, 'AfD': 20, 'FDP': 3, 'BSW': 3, 'Grüne': 12, 'Linke': 6, 'Sonstige': 4},
  'history': [
    {'date': '19.02.2025', 'results': {'CDU': 30, 'SPD': 25, 'AfD': 16, 'FDP': 5, 'BSW': 5, 'Grüne': 10, 'Linke': 5, 'Sonstige': 4}},
    {'date': '05.12.2024', 'results': {'CDU': 33, 'SPD': 27, 'AfD': 16, 'FDP': 4, 'BSW': 4, 'Grüne': 10, 'Linke': 0, 'Sonstige': 6}},
    {'date': '12.11.2024', 'results': {'CDU': 31, 'SPD': 26, 'AfD': 16, 'FDP': 4, 'BSW': 6, 'Grüne': 10, 'Linke': 2, 'Sonstige': 5}}
  ]
}, 
'Nordrhein-Westfalen': {
  'date': '01.02.2026', 
  'results': {'CDU': 35, 'SPD': 20, 'AfD': 15, 'FDP': 4, 'BSW': 0, 'Grüne': 13, 'Linke': 6, 'Sonstige': 7},
  'history': [
    {'date': '23.11.2025', 'results': {'CDU': 36, 'SPD': 19, 'AfD': 16, 'FDP': 5, 'BSW': 0, 'Grüne': 12, 'Linke': 7, 'Sonstige': 5}},
    {'date': '22.08.2025', 'results': {'CDU': 35, 'SPD': 18, 'AfD': 16, 'FDP': 4, 'BSW': 3, 'Grüne': 13, 'Linke': 8, 'Sonstige': 3}},
    {'date': '09.07.2025', 'results': {'CDU': 38, 'SPD': 17, 'AfD': 16, 'FDP': 3, 'BSW': 2, 'Grüne': 13, 'Linke': 7, 'Sonstige': 4}}
  ]
}, 
'Rheinland-Pfalz': {
  'date': '22.01.2026', 
  'results': {'CDU': 29, 'SPD': 26, 'AfD': 18, 'FDP': 0, 'BSW': 0, 'Grüne': 10, 'Linke': 6, 'Sonstige': 11},
  'history': [
    {'date': '09.10.2025', 'results': {'CDU': 29, 'SPD': 23, 'AfD': 19, 'FDP': 0, 'BSW': 0, 'Grüne': 10, 'Linke': 6, 'Sonstige': 13}},
    {'date': '04.10.2025', 'results': {'CDU': 27, 'SPD': 22, 'AfD': 23, 'FDP': 4, 'BSW': 4, 'Grüne': 9, 'Linke': 6, 'Sonstige': 5}},
    {'date': '20.06.2025', 'results': {'CDU': 28, 'SPD': 24.5, 'AfD': 18, 'FDP': 2, 'BSW': 3, 'Grüne': 10.5, 'Linke': 5.5, 'Sonstige': 8.5}}
  ]
}, 
'Saarland': {
  'date': '03.12.2025', 
  'results': {'CDU': 25, 'SPD': 27, 'AfD': 23, 'FDP': 0, 'BSW': 3, 'Grüne': 7, 'Linke': 7, 'Sonstige': 8},
  'history': [
    {'date': '02.04.2025', 'results': {'CDU': 27, 'SPD': 30, 'AfD': 17, 'FDP': 3, 'BSW': 4, 'Grüne': 6, 'Linke': 8, 'Sonstige': 5}},
    {'date': '26.09.2024', 'results': {'CDU': 31, 'SPD': 29, 'AfD': 14, 'FDP': 0, 'BSW': 10, 'Grüne': 5, 'Linke': 0, 'Sonstige': 11}},
    {'date': '04.05.2024', 'results': {'CDU': 28, 'SPD': 36, 'AfD': 8.5, 'FDP': 3.5, 'BSW': 9, 'Grüne': 5, 'Linke': 2, 'Sonstige': 8}}
  ]
}, 
'Sachsen': {
  'date': '06.01.2026', 
  'results': {'CDU': 29, 'SPD': 6, 'AfD': 35, 'FDP': 1, 'BSW': 8, 'Grüne': 6, 'Linke': 10, 'Sonstige': 5},
  'history': [
    {'date': '04.08.2025', 'results': {'CDU': 27, 'SPD': 6, 'AfD': 35, 'FDP': 1, 'BSW': 9, 'Grüne': 6, 'Linke': 10, 'Sonstige': 6}},
    {'date': '08.07.2025', 'results': {'CDU': 29, 'SPD': 5, 'AfD': 34, 'FDP': 1, 'BSW': 9, 'Grüne': 5, 'Linke': 10, 'Sonstige': 7}},
    {'date': '07.06.2025', 'results': {'CDU': 26, 'SPD': 6, 'AfD': 35, 'FDP': 0, 'BSW': 11, 'Grüne': 5, 'Linke': 9, 'Sonstige': 8}}
  ]
}, 
'Sachsen-Anhalt': {
  'date': '27.01.2026', 
  'results': {'CDU': 26, 'SPD': 8, 'AfD': 39, 'FDP': 2, 'BSW': 6, 'Grüne': 3, 'Linke': 11, 'Sonstige': 5},
  'history': [
    {'date': '15.10.2025', 'results': {'CDU': 26, 'SPD': 6, 'AfD': 40, 'FDP': 3, 'BSW': 6, 'Grüne': 3, 'Linke': 11, 'Sonstige': 5}},
    {'date': '04.09.2025', 'results': {'CDU': 27, 'SPD': 7, 'AfD': 39, 'FDP': 0, 'BSW': 6, 'Grüne': 3, 'Linke': 13, 'Sonstige': 5}},
    {'date': '19.06.2025', 'results': {'CDU': 34, 'SPD': 7, 'AfD': 30, 'FDP': 2, 'BSW': 8, 'Grüne': 3, 'Linke': 11, 'Sonstige': 5}}
  ]
}, 
'Schleswig-Holstein': {
  'date': '22.01.2025', 
  'results': {'CDU': 39, 'SPD': 16, 'AfD': 14, 'FDP': 4, 'BSW': 3, 'Grüne': 13, 'Linke': 0, 'Sonstige': 11},
  'history': [
    {'date': '15.11.2023', 'results': {'CDU': 40, 'SPD': 15, 'AfD': 12, 'FDP': 6, 'BSW': 0, 'Grüne': 16, 'Linke': 0, 'Sonstige': 11}},
    {'date': '02.10.2023', 'results': {'CDU': 32.5, 'SPD': 14, 'AfD': 15, 'FDP': 5, 'BSW': 0, 'Grüne': 18, 'Linke': 1.5, 'Sonstige': 14}},
    {'date': '27.04.2023', 'results': {'CDU': 38, 'SPD': 15, 'AfD': 8, 'FDP': 8, 'BSW': 0, 'Grüne': 17, 'Linke': 0, 'Sonstige': 14}}
  ]
}, 
'Thüringen': {
  'date': '05.02.2026', 
  'results': {'CDU': 24, 'SPD': 7, 'AfD': 38, 'FDP': 0, 'BSW': 7, 'Grüne': 3, 'Linke': 14, 'Sonstige': 7},
  'history': [
    {'date': '11.12.2025', 'results': {'CDU': 24, 'SPD': 6, 'AfD': 39, 'FDP': 0, 'BSW': 7, 'Grüne': 3, 'Linke': 14, 'Sonstige': 7}},
    {'date': '11.09.2025', 'results': {'CDU': 25, 'SPD': 7, 'AfD': 37, 'FDP': 0, 'BSW': 9, 'Grüne': 3, 'Linke': 14, 'Sonstige': 5}},
    {'date': '08.05.2025', 'results': {'CDU': 24, 'SPD': 8, 'AfD': 35, 'FDP': 0, 'BSW': 11, 'Grüne': 3, 'Linke': 14, 'Sonstige': 5}}
  ]
}
};

let currentState = null;

function parseDate(dateStr) {
  // Parse DD.MM.YYYY format
  const parts = dateStr.split('.');
  if(parts.length !== 3 || dateStr.includes('X')) return null;
  return new Date(parts[2], parts[1] - 1, parts[0]);
}

function findNewestPoll() {
  let newestDate = null;
  let newestLocation = null;
  let newestIsBundestag = false;
  
  // Check Bundestag
  const bundestagDate = parseDate(bundestagData.date);
  if(bundestagDate) {
    newestDate = bundestagDate;
    newestLocation = 'Bundestag';
    newestIsBundestag = true;
  }
  
  // Check all Landtag states
  Object.entries(data).forEach(([state, stateData]) => {
    const stateDate = parseDate(stateData.date);
    if(stateDate && (!newestDate || stateDate > newestDate)) {
      newestDate = stateDate;
      newestLocation = state;
      newestIsBundestag = false;
    }
  });
  
  return { 
    date: newestDate, 
    location: newestLocation, 
    isBundestag: newestIsBundestag,
    dateString: formatDate(newestDate)
  };
}

function getLeadingParty(results) {
  let maxPercent = 0;
  let leadingParty = null;
  Object.entries(results).forEach(([party, percent]) => {
    if(percent > maxPercent) {
      maxPercent = percent;
      leadingParty = party;
    }
  });
  return leadingParty;
}

function formatDate(date) {
  const day = String(date.getDate()).padStart(2, '0');
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const year = date.getFullYear();
  return `${day}.${month}.${year}`;
}

function buildStates(){
  const newest = findNewestPoll();
  const c=document.getElementById("states");
  Object.keys(data).forEach(s=>{
    const d=document.createElement("div");
    d.className="state";
    d.onclick=()=>showState(s);
    
    // Get leading party and set border color
    const leadingParty = getLeadingParty(data[s].results);
    d.style.borderColor = colors[leadingParty] || 'transparent';
    
    // Create content container
    const contentDiv = document.createElement("div");
    contentDiv.className = "state-content";
    
    const img=document.createElement("img");
    img.src=stateCoats[s];
    img.alt=s+" Wappen";
    const name=document.createElement("div");
    name.className="state-name";
    name.textContent=s;
    
    contentDiv.appendChild(img);
    contentDiv.appendChild(name);
    d.appendChild(contentDiv);
    
    // Add "Neue Umfrage" badge at bottom if this has the newest date
    if(data[s].date === newest.dateString) {
      const badgeContainer = document.createElement("div");
      badgeContainer.className = "badge-container";
      const badge = document.createElement("span");
      badge.className = "new-badge";
      badge.textContent = "Neue Umfrage";
      badgeContainer.appendChild(badge);
      d.appendChild(badgeContainer);
    }
    
    c.appendChild(d);
  });
}

function showState(state){
  // Update active state
  if(currentState) {
    const prevStates = document.querySelectorAll('.state');
    prevStates.forEach(s => s.classList.remove('active'));
  }
  currentState = state;
  const states = document.querySelectorAll('.state');
  states.forEach((s, i) => {
    if(Object.keys(data)[i] === state) {
      s.classList.add('active');
    }
  });

  // Update background coat of arms
  const panel = document.querySelector('.panel');
  panel.style.setProperty('--bg-coat', `url(${stateCoats[state]})`);

  const bars=document.getElementById("bars");
  bars.innerHTML="";
  document.getElementById("title").innerText=state;
  document.getElementById("date").innerText="Stand: "+data[state].date;
  
  // Calculate trends from most recent history
  const currentResults = data[state].results;
  const previousResults = data[state].history[0].results;
  
  let entries=Object.entries(currentResults).sort((a,b)=>{
    // Always put Sonstige last
    if(a[0] === 'Sonstige') return 1;
    if(b[0] === 'Sonstige') return -1;
    // Sort others by percentage descending
    return b[1]-a[1];
  });
  entries.forEach(([p,v], index)=>{
    const r=document.createElement("div");
    r.className="bar-row";
    
    const logo=document.createElement("img");
    logo.src=logos[p];
    logo.className="party-logo";
    logo.alt=p+" Logo";
    
    const b=document.createElement("div");
    b.className="bar";
    // Better scaling for small percentages: base 70px + 10px per percent
    const targetWidth = (v > 0 ? (70 + v*10) : 0)+"px";
    b.style.background=colors[p];
    b.style.color = (p==="FDP" ? "#000" : "#fff");
    b.textContent = p;
    
    // Calculate exact percentage difference
    const prevValue = previousResults[p] || 0;
    const diff = v - prevValue;
    let trendText = '';
    let trendClass = 'same';
    
    if(diff > 0) { 
      trendText = '+' + diff + '%'; 
      trendClass = 'up'; 
    } else if(diff < 0) { 
      trendText = diff + '%'; 
      trendClass = 'down'; 
    } else {
      trendText = '±0%';
    }
    
    // Trigger animation with delay
    setTimeout(() => {
      b.classList.add('animate');
      b.style.width = targetWidth;
    }, index * 100);
    
    const pc=document.createElement("div");
    pc.className="percent";
    pc.innerHTML = v+'% <span class="trend '+trendClass+'">'+trendText+'</span>';
    
    r.appendChild(logo);
    r.appendChild(b);
    r.appendChild(pc);
    bars.appendChild(r);
  });
  
  // Display historical data
  const historyDiv = document.getElementById("history");
  historyDiv.innerHTML = "";
  
  data[state].history.forEach(h => {
    const row = document.createElement("div");
    row.className = "history-row";
    
    const dateDiv = document.createElement("div");
    dateDiv.className = "history-date";
    dateDiv.textContent = h.date;
    row.appendChild(dateDiv);
    
    const partiesDiv = document.createElement("div");
    partiesDiv.className = "history-parties";
    
    // Sort parties by their historical percentages, but always put Sonstige last
    const historicalEntries = Object.entries(h.results).sort((a,b)=>{
      // Always put Sonstige last
      if(a[0] === 'Sonstige') return 1;
      if(b[0] === 'Sonstige') return -1;
      // Sort others by percentage descending
      return b[1]-a[1];
    });
    historicalEntries.forEach(([p, v]) => {
      if(v > 0) {
        const partyDiv = document.createElement("div");
        partyDiv.className = "history-party";
        
        const nameDiv = document.createElement("div");
        nameDiv.className = "history-party-name";
        nameDiv.textContent = p;
        
        const valueDiv = document.createElement("div");
        valueDiv.className = "history-party-value";
        valueDiv.textContent = v + "%";
        
        partyDiv.appendChild(nameDiv);
        partyDiv.appendChild(valueDiv);
        partiesDiv.appendChild(partyDiv);
      }
    });
    
    row.appendChild(partiesDiv);
    historyDiv.appendChild(row);
  });
}

function showBundestag() {
  const newest = findNewestPoll();
  const bars = document.getElementById("bundestag-bars");
  bars.innerHTML = "";
  
  // Set border color based on leading party
  const leadingParty = getLeadingParty(bundestagData.results);
  const bundestagContainer = document.querySelector('.bundestag-container');
  bundestagContainer.style.borderColor = colors[leadingParty] || 'transparent';
  
  // Update date without badge
  document.getElementById("bundestag-date").innerHTML = "Stand: " + bundestagData.date;
  
  // Update badge container if newest
  const badgeContainer = document.getElementById("bundestag-badge");
  badgeContainer.innerHTML = "";
  if(bundestagData.date === newest.dateString) {
    const badge = document.createElement("span");
    badge.className = "new-badge";
    badge.textContent = "Neue Umfrage";
    badgeContainer.appendChild(badge);
  }
  
  // Calculate trends from most recent history
  const currentResults = bundestagData.results;
  const previousResults = bundestagData.history[0].results;
  
  let entries = Object.entries(currentResults).sort((a,b) => {
    // Always put Sonstige last
    if(a[0] === 'Sonstige') return 1;
    if(b[0] === 'Sonstige') return -1;
    // Sort others by percentage descending
    return b[1] - a[1];
  });
  entries.forEach(([p, v], index) => {
    const r = document.createElement("div");
    r.className = "bar-row";
    
    const logo = document.createElement("img");
    logo.src = logos[p];
    logo.className = "party-logo";
    logo.alt = p + " Logo";
    
    const b = document.createElement("div");
    b.className = "bar";
    // Better scaling for small percentages: base 70px + 10px per percent
    const targetWidth = (v > 0 ? (70 + v * 10) : 0) + "px";
    b.style.background = colors[p];
    b.style.color = (p === "FDP" ? "#000" : "#fff");
    b.textContent = p;
    
    // Calculate exact percentage difference
    const prevValue = previousResults[p] || 0;
    const diff = v - prevValue;
    let trendText = '';
    let trendClass = 'same';
    
    if(diff > 0) { 
      trendText = '+' + diff + '%'; 
      trendClass = 'up'; 
    } else if(diff < 0) { 
      trendText = diff + '%'; 
      trendClass = 'down'; 
    } else {
      trendText = '±0%';
    }
    
    // Trigger animation with delay
    setTimeout(() => {
      b.classList.add('animate');
      b.style.width = targetWidth;
    }, index * 100);
    
    const pc = document.createElement("div");
    pc.className = "percent";
    pc.innerHTML = v + '% <span class="trend ' + trendClass + '">' + trendText + '</span>';
    
    r.appendChild(logo);
    r.appendChild(b);
    r.appendChild(pc);
    bars.appendChild(r);
  });
}

buildStates();
showBundestag();

// Display newest poll info at the top
const newest = findNewestPoll();
if(newest.date) {
  const newestInfo = document.getElementById('newest-poll-info');
  newestInfo.textContent = `Neuste Umfrage: ${formatDate(newest.date)} (${newest.location})`;
}

// Show first state by default
showState(Object.keys(data)[0]);
</script>
</body>
</html>
